<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Android Room with A View | thirtyyuan&#39;s Den</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="原文地址 Android Room with A View——Google Codelab

1. 介绍 结构化组件 的目的在于提供 app 架构指导，并因此提供有关于常见任务的库，如 生命周期管理、数据持久化。
结构化组件帮助你用更少的模版代码通过健壮的、可测试的和可维护的方式构建应用程序。
结构化组件提供了一个简单的、灵活的、实用的方式，从一些常见问题中解放你，使你能够专注于构建更好的产品体">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Room with A View">
<meta property="og:url" content="http://thirtyyuan.github.io/2018/07/29/Android_Room_with_A_View/index.html">
<meta property="og:site_name" content="thirtyyuan's Den">
<meta property="og:description" content="原文地址 Android Room with A View——Google Codelab

1. 介绍 结构化组件 的目的在于提供 app 架构指导，并因此提供有关于常见任务的库，如 生命周期管理、数据持久化。
结构化组件帮助你用更少的模版代码通过健壮的、可测试的和可维护的方式构建应用程序。
结构化组件提供了一个简单的、灵活的、实用的方式，从一些常见问题中解放你，使你能够专注于构建更好的产品体">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tNc79ly1ftqjqb173gj30hc0a2757.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tNc79ly1ftqlbkf0j6j30zk0jmtdg.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNc79ly1ftqleczt69j30fi0cqq3c.jpg">
<meta property="og:image" content="https://ws3.sinaimg.cn/large/006tNc79ly1ftqlv567hoj318g0yg0wc.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tNc79gy1ftqqtcnm83j309a05l74d.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tNc79gy1ftqvnr2tvrj30ds04oaa3.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tNc79gy1ftr1cilhxqj30d1082aae.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tNc79gy1ftr3bbp618j30p018gwfi.jpg">
<meta property="og:image" content="https://ws3.sinaimg.cn/large/006tNc79gy1ftr4rou9tfj30fi0cqaaw.jpg">
<meta property="og:updated_time" content="2018-07-30T00:30:59.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Room with A View">
<meta name="twitter:description" content="原文地址 Android Room with A View——Google Codelab

1. 介绍 结构化组件 的目的在于提供 app 架构指导，并因此提供有关于常见任务的库，如 生命周期管理、数据持久化。
结构化组件帮助你用更少的模版代码通过健壮的、可测试的和可维护的方式构建应用程序。
结构化组件提供了一个简单的、灵活的、实用的方式，从一些常见问题中解放你，使你能够专注于构建更好的产品体">
<meta name="twitter:image" content="https://ws1.sinaimg.cn/large/006tNc79ly1ftqjqb173gj30hc0a2757.jpg">
  
    <link rel="alternative" href="/atom.xml" title="thirtyyuan&#39;s Den" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/head.jpg" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/" title="Hi Mate">thirtyyuan</a></h1>
        </hgroup>

        
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">博客首页</a></li>
                        
                            <li><a href="/works">作品展示</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl github" target="_blank" href="https://github.com/thirtyyuan" title="github">github</a>
                            
                                <a class="fl stackoverflow" target="_blank" href="https://stackoverflow.com/users/5635548/brad-yuan" title="stackoverflow">stackoverflow</a>
                            
                                <a class="fl weibo" target="_blank" href="http://weibo.com/5172859382" title="weibo">weibo</a>
                            
                                <a class="fl twitter" target="_blank" href="https://twitter.com/thirtyyuan" title="twitter">twitter</a>
                            
                                <a class="fl facebook" target="_blank" href="https://www.facebook.com/thirtyyuan" title="facebook">facebook</a>
                            
                                <a class="fl rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/Algorithm/" style="font-size: 10px;">Algorithm</a> <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/Architecture-Components/" style="font-size: 10px;">Architecture Components</a> <a href="/tags/Database/" style="font-size: 10px;">Database</a> <a href="/tags/JDK/" style="font-size: 10px;">JDK</a> <a href="/tags/Room/" style="font-size: 10px;">Room</a> <a href="/tags/Runtime-Permission/" style="font-size: 10px;">Runtime Permission</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/乐联网平台/" style="font-size: 10px;">乐联网平台</a> <a href="/tags/初见/" style="font-size: 10px;">初见</a> <a href="/tags/刷机/" style="font-size: 10px;">刷机</a> <a href="/tags/日记/" style="font-size: 10px;">日记</a> <a href="/tags/权限管理/" style="font-size: 10px;">权限管理</a> <a href="/tags/物联网/" style="font-size: 10px;">物联网</a> <a href="/tags/环境搭建/" style="font-size: 10px;">环境搭建</a> <a href="/tags/综合/" style="font-size: 10px;">综合</a> <a href="/tags/设计/" style="font-size: 10px;">设计</a> <a href="/tags/踩坑/" style="font-size: 10px;">踩坑</a>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://luuman.github.io">luuman</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://gank.io">Gank.io</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://onevcat.com">onevcat</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://stormzhang.com">stormzhang</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">嗨！我是袁宏磊，一名来自中国的「 android 开发者」，现居昆明，学习 android 中，喜欢运动，追求吃饭睡觉等生活的艺术。</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="Me">thirtyyuan</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/head.jpg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="Me">thirtyyuan</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">博客首页</a></li>
                
                    <li><a href="/works">作品展示</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="github" target="_blank" href="https://github.com/thirtyyuan" title="github">github</a>
                    
                        <a class="stackoverflow" target="_blank" href="https://stackoverflow.com/users/5635548/brad-yuan" title="stackoverflow">stackoverflow</a>
                    
                        <a class="weibo" target="_blank" href="http://weibo.com/5172859382" title="weibo">weibo</a>
                    
                        <a class="twitter" target="_blank" href="https://twitter.com/thirtyyuan" title="twitter">twitter</a>
                    
                        <a class="facebook" target="_blank" href="https://www.facebook.com/thirtyyuan" title="facebook">facebook</a>
                    
                        <a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-Android_Room_with_A_View" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/07/29/Android_Room_with_A_View/" class="article-date">
      <time datetime="2018-07-29T15:53:50.000Z" itemprop="datePublished">2018-07-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Android Room with A View
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/android开发/">android开发</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Architecture-Components/">Architecture Components</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Database/">Database</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Room/">Room</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <blockquote>
<p>原文地址 <a href="https://codelabs.developers.google.com/codelabs/android-room-with-a-view/#0" target="_blank" rel="external">Android Room with A View——Google Codelab</a></p>
</blockquote>
<h3 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1. 介绍"></a>1. 介绍</h3><p> <a href="https://developer.android.com/topic/libraries/architecture/index.html" target="_blank" rel="external">结构化组件</a> 的目的在于提供 app 架构指导，并因此提供有关于常见任务的库，如 生命周期管理、数据持久化。</p>
<p>结构化组件帮助你用更少的模版代码通过健壮的、可测试的和可维护的方式构建应用程序。</p>
<p>结构化组件提供了一个简单的、灵活的、实用的方式，从一些常见问题中解放你，使你能够专注于构建更好的产品体检。<br><a id="more"></a></p>
<h4 id="推荐给你的结构化组件是什么？"><a href="#推荐给你的结构化组件是什么？" class="headerlink" title="推荐给你的结构化组件是什么？"></a>推荐给你的结构化组件是什么？</h4><p>为了介绍专业术语，这里有一个对结构化组件的简介，以及它们是怎样一同工作的。注意，本文仅专注于介绍部分组件的基础知识，它们是：LiveData、ViewModel 和 Room。下图展示了这种结构的基本形式。<br><img src="https://ws1.sinaimg.cn/large/006tNc79ly1ftqjqb173gj30hc0a2757.jpg" alt="结构的基本形式"></p>
<p>Entity：当于其他结构化组件一起工作时，这是一个带注释的类，用于描述数据库表。</p>
<p>SQLite 数据库：在设备上，数据存储在 SQLite 数据库中。为简单起见，省略了其他存储选项，例如 Web 服务器。  Room 持久性库为你创建和维护此数据库。</p>
<p>DAO：数据访问对象。它是 SQL 查询到函数的映射。你曾经必须在 SQLiteOpenHelper 类中精心定义这些方法。当你使用 DAO 时，你可以调用这些映射方法，而 Room 负责其余的操作。</p>
<p>Room 数据库：SQLite 数据库之上的数据库层，负责处理你过去使用 SQLiteOpenHelper 处理的普通任务。它是数据库持有者，作为底层 SQLite 数据库的访问点，Room 数据库使用 DAO 向 SQLite 数据库发出查询。</p>
<p>Repository（存储库）：它是你创建的类，例如 WordRepository 类。你使用存储库来管理多个数据源。</p>
<p>ViewModel：为UI提供数据。充当存储库和UI之间的通信中心。隐藏于 UI 于数据源之间。 ViewModel 实例在配置更改后仍然存在。</p>
<p>LiveData：可被观察的数据持有者类。始终保存/缓存最新的数据。数据发生变化时通知其观察者。 LiveData 有生命周期意识。 UI 组件只是观察相关数据，不会停止或恢复观察。 LiveData 自动管理所有这些，因为它在观察中能意识到相关的生命周期状态变化。</p>
<h4 id="你将构建什么？（需求）"><a href="#你将构建什么？（需求）" class="headerlink" title="你将构建什么？（需求）"></a>你将构建什么？（需求）</h4><p>你将用 Android 结构化组件并为这些组件实现源自<a href="https://developer.android.com/topic/libraries/architecture/guide.html" target="_blank" rel="external">应用架构指导</a>中的结构，以此来构建一个应用程序。这个示例应用程序再一个 Room 数据库中存储一个单词列表，并将它显示于 RecyclerView 中。该应用程序是很简易的，但它也足够复杂，因此你可以使用它作为模版，在其之上构建你的应用程序。</p>
<p>在本次编程实验中，你将基于以下步骤构建应用程序：</p>
<ul>
<li>与数据库交互，拿到并保存数据，并用一些单词预先填充到数据库中。</li>
<li>在 MainActivity 的 RecyclerView 中显示这些单词。</li>
<li>当用户点击 「+」按钮时，打开第二个 Activity，当用户输入一个单词，将它添加到数据库和列表中。</li>
</ul>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1ftqlbkf0j6j30zk0jmtdg.jpg" alt="需求"></p>
<h4 id="RoomWordSample-架构概览"><a href="#RoomWordSample-架构概览" class="headerlink" title="RoomWordSample 架构概览"></a>RoomWordSample 架构概览</h4><p>下图展示了该应用程序的全部片段，每个框（SQLite数据库除外）代表您将创建的类。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1ftqleczt69j30fi0cqq3c.jpg" alt="项目结构"></p>
<h4 id="你将学到什么？"><a href="#你将学到什么？" class="headerlink" title="你将学到什么？"></a>你将学到什么？</h4><blockquote>
<p>用结构化组件 Room 和 Lifecycles 库怎样设计并构建一个应用程序。</p>
</blockquote>
<p> 使用结构化组件并实现推荐的架构有很多步骤。最重要的是创建一个关于正在做什么、发生什么的心理模型（心里有数），并理解这些单个部分该如何组合到一起，以及数据是怎样流动的。当你使用该代码实验室时，不要只是复制粘贴代码，而要尝试从内部理解后着手构建。</p>
<h3 id="2-创建你的应用程序"><a href="#2-创建你的应用程序" class="headerlink" title="2. 创建你的应用程序"></a>2. 创建你的应用程序</h3><p>打开 Android Studio 并按下列步骤创建应用程序：</p>
<ul>
<li>将该应用程序命名为 RoomWorkSample</li>
<li>目标 API 设为 26+</li>
<li>取消勾选 <code>include Kotlin support</code>和<code>include C++ support</code></li>
<li>选中 <code>Phone &amp; Tablet</code> 并设置最小 SDK API 为 26</li>
<li>选则 <code>Basic Activity</code></li>
</ul>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1ftqlv567hoj318g0yg0wc.jpg" alt="Basic Activity"></p>
<h3 id="3-更新-gradle-文件"><a href="#3-更新-gradle-文件" class="headerlink" title="3. 更新 gradle 文件"></a>3. 更新 gradle 文件</h3><p>你必须添加组件库到你的 gradle 文件中。添加以下代码到 build.gradle (Module: app) 文件末尾的依赖 (dependencies) 中。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Room components</span></div><div class="line">implementation <span class="string">"android.arch.persistence.room:runtime:$rootProject.roomVersion"</span></div><div class="line">annotationProcessor <span class="string">"android.arch.persistence.room:compiler:$rootProject.roomVersion"</span></div><div class="line">androidTestImplementation <span class="string">"android.arch.persistence.room:testing:$rootProject.roomVersion"</span></div><div class="line"></div><div class="line"><span class="comment">// Lifecycle components</span></div><div class="line">implementation <span class="string">"android.arch.lifecycle:extensions:$rootProject.archLifecycleVersion"</span></div><div class="line">annotationProcessor <span class="string">"android.arch.lifecycle:compiler:$rootProject.archLifecycleVersion"</span></div></pre></td></tr></table></figure>
<p>在你的 build.gradle (Project: RoomWordsSample) 文件末尾添加如下代码所示的版本号：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ext &#123;</div><div class="line">   roomVersion = <span class="string">'1.0.0'</span></div><div class="line">   archLifecycleVersion = <span class="string">'1.1.0'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4-创建-Entity-实体"><a href="#4-创建-Entity-实体" class="headerlink" title="4. 创建 Entity (实体)"></a>4. 创建 Entity (实体)</h3><p>该应用程序的数据是单词，每一个单词是一个实体 (Entity)。创建一个叫做  <code>Word</code> 的类来描述一个单词实体。你需要为数据模型类 (data model class) 添加一个构造器和一个<code>getter</code> 方法，以此告知 <code>Room</code> 类如何实例化你的对象。</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1ftqqtcnm83j309a05l74d.jpg" alt="Word 实体"></p>
<p>这里是实现代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Word</span> </span>&#123;</div><div class="line"></div><div class="line">   <span class="keyword">private</span> String mWord;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Word</span><span class="params">(@NonNull String word)</span> </span>&#123;<span class="keyword">this</span>.mWord = word;&#125;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getWord</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="keyword">this</span>.mWord;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>为了使<code>Word</code>类对 Room 数据库有意义，你需要注解它。注解标明了这个类的每一部分与数据库中条目的关系。Room 用这些信息生成代码。</p>
<ul>
<li><code>@Entity(tableName = &quot;word_table&quot;)</code><br>每个 <code>@Entity</code> 类表示一张表中的一个实体。你对类的注解声明它是一个实体。特别的，你可以给它定义一个不同于类名的表名。</li>
<li><code>@PrimaryKey</code><br>每个实体都需要一个主键。为了保持简单，每个单词都作为他自己的主键。</li>
<li><code>@NonNull</code><br>声明一个参数、域或方法返回值不可以为 null。</li>
<li>@ColumnInfo(name = “word”)<br>特别的，如果你想要这个表中列的名字不同于成员变量的名字，可以使用该注解。</li>
<li>存在数据库中的每个域必须是 public 或 有 “getter” 方法。本例中仅提供一个 <code>getWord()</code> 方法。</li>
</ul>
<p>你可以在这个链接中找到完整注解列表： <a href="https://developer.android.com/reference/android/arch/persistence/room/package-summary.html" target="_blank" rel="external">Room packge summary reference</a>。<br>像下面代码一样使用注解更新你的 <code>Word</code>类。如果你输入了注解，Android Studio 会自动引入它。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Entity</span>(tableName = <span class="string">"word_table"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Word</span> </span>&#123;</div><div class="line"></div><div class="line">   <span class="meta">@PrimaryKey</span></div><div class="line">   <span class="meta">@NonNull</span></div><div class="line">   <span class="meta">@ColumnInfo</span>(name = <span class="string">"word"</span>)</div><div class="line">   <span class="keyword">private</span> String mWord;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Word</span><span class="params">(String word)</span> </span>&#123;<span class="keyword">this</span>.mWord = word;&#125;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getWord</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="keyword">this</span>.mWord;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当你复制粘贴以上代码时，如果产生了注解有关的错误，你需要手动引入这些注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> android.arch.persistence.room.ColumnInfo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.arch.persistence.room.Entity;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.arch.persistence.room.PrimaryKey;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.support.annotation.NonNull;</div></pre></td></tr></table></figure>
<p>提示：你可以通过下面这样注解主键来 <a href="https://developer.android.com/reference/android/arch/persistence/room/PrimaryKey.html" target="_blank" rel="external">自动生成（autogenerate）</a> 不同的键。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Entity</span>(tableName = <span class="string">"word_table"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Word</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="meta">@PrimaryKey</span>(autoGenerate = <span class="keyword">true</span>)</div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> id;</div><div class="line"></div><div class="line"><span class="meta">@NonNull</span></div><div class="line"><span class="keyword">private</span> String word;</div><div class="line"><span class="comment">//..other fields, getters, setters</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>参考 <a href="https://developer.android.com/training/data-storage/room/defining-data.html" target="_blank" rel="external">用 Room 实体定义数据</a>。</p>
<h3 id="5-创建-DAO（Data-Access-Object）"><a href="#5-创建-DAO（Data-Access-Object）" class="headerlink" title="5. 创建 DAO（Data Access Object）"></a>5. 创建 DAO（Data Access Object）</h3><h4 id="什么是-DAO？"><a href="#什么是-DAO？" class="headerlink" title="什么是 DAO？"></a>什么是 DAO？</h4><p>在 <a href="https://developer.android.com/training/data-storage/room/accessing-data.html" target="_blank" rel="external">DAO</a> 中，你特定的 SQL 查询和关于他们的方法调用。编译器检查 SQL 并从会话注解中为常见查询生成查询语句，例如 <code>@Insert</code>。</p>
<ul>
<li>DAO 必须是一个接口或抽象类。</li>
<li>默认的所有的查询操作都在独立线程中执行。</li>
<li>Room 使用 DAO 为你的代码创建干净的 API。</li>
</ul>
<h4 id="实现-DAO"><a href="#实现-DAO" class="headerlink" title="实现 DAO"></a>实现 DAO</h4><p>本示例中的 DAO 是一个基本的、并为获取所有的单词、插入单词、删除所有的单词提供了查询操作。</p>
<ol>
<li>创建一个叫做 <code>WordDao</code> 的接口。</li>
<li>使用 <code>@Dao</code> 注解这个类，以标示它为 Room 的一个 DAO 类。</li>
<li>声明一个插入一个单词的方法：<code>void insert(Word word)</code>；</li>
<li>用 <code>@Insert</code>注解这个方法。你不必提供任何 SQL！（也有 <code>@Delete</code> 和 <code>@Update</code> 注解用于删除和更新一行数据／实体，但是本实例中并用不到它们）</li>
<li>声明一个方法用于删除全部单词：<code>void deleteAll();</code>。</li>
<li>有个非会话注解用于删除多个实体，这个注解使用泛型来注解一个方法<code>@Query</code>。</li>
<li>提供 SQL 查询作为 <code>@Query</code> 的字符串参数。用 <code>@Query</code> 为了完成查询操作需要提供 SQL 语句。<code>@Query(&quot;DELETE FROM word_table&quot;)</code></li>
<li>创建一个方法以得到全部单词：<code>getAllWords();</code>。这个方法返回一个 <code>Words</code>类型的<code>List</code>。<code>List&lt;Word&gt; getAllWords()</code>;</li>
<li>用下面的 SQL 语句注解 8 中的方法：<code>@Query(&quot;SELECT * from word_table ORDER BY word ASC&quot;)</code>。</li>
</ol>
<p>以下是完整代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Dao</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">WordDao</span> </span>&#123;</div><div class="line"></div><div class="line">   <span class="meta">@Insert</span></div><div class="line">   <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Word word)</span></span>;</div><div class="line"></div><div class="line">   <span class="meta">@Query</span>(<span class="string">"DELETE FROM word_table"</span>)</div><div class="line">   <span class="function"><span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">   <span class="meta">@Query</span>(<span class="string">"SELECT * from word_table ORDER BY word ASC"</span>)</div><div class="line">   <span class="function">List&lt;Word&gt; <span class="title">getAllWords</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>提示：对于这个应用程序，对单词的排序不是必须的。然而，默认是不提供排序的，并且排序能更直接、简单的测试。</p>
</blockquote>
<hr>
<blockquote>
<p>提示：当插入数据时，你能够提供一个冲突策略。<br>在本次示例中，你不需要一个冲突策略，因为单词是你的主键，并且 SQL 默认的表现策略是舍弃（ABORT），因此你不可以用相同的主键插入两个 items 到数据库中。<br>如果有冲突，你可以用 <code>@Insert(onConflict = OnConflictStrategy.REPLACE)</code> 来代替原有的数据。</p>
</blockquote>
<p>查看关于 <a href="https://developer.android.com/training/data-storage/room/accessing-data.html" target="_blank" rel="external">Room Daos</a> 的更多内容。</p>
<h3 id="6-LiveData-类"><a href="#6-LiveData-类" class="headerlink" title="6. LiveData 类"></a>6. LiveData 类</h3><p>当数据改变时，你通常想要做一些事情，例如更新 UI 中显示的数据。这意味着你不得不观察数据，以至于当它改变时，你可以作出响应。根据数据存储方式的不同，这通常很棘手。观察应用程序的多个组件之间的数据更改可以在组件之间创建明确，严格的依赖关系路径。这使得测试和调试变得困难等等。这会使得测试、调试困难等等。</p>
<p>LiveData，一个为了数据观察的生命周期库，解决了上述问题。使用一个类型为 LiveData 的返回值在你的方法声明中，然后 Room 产生全部必须的代码，在数据库更新时来更新你的 LiveData。</p>
<blockquote>
<p>如果你独立于 Room 使用 <code>LiveData</code>，你必须管理更新数据。<code>LiveData</code>没有公开、可用的方法来更新存储的数据。</p>
<p>如果开发者想要更新存储的数据，你必须用 <a href="https://developer.android.com/reference/android/arch/lifecycle/MutableLiveData.html" target="_blank" rel="external">MutableLiveData</a> 而不是 <code>LiveData</code>。<code>MutableLiveData</code> 类有两个公共方法允许你给一个<code>LiveData</code>对象设置值，<a href="https://developer.android.com/reference/android/arch/lifecycle/MutableLiveData.html#setValue(T" target="_blank" rel="external">setValue(T)</a>) 和 <a href="https://developer.android.com/reference/android/arch/lifecycle/MutableLiveData.html#postValue(T" target="_blank" rel="external">postValue(T)</a>)。通常，<code>MutableLiveData</code> 用于 <a href="https://developer.android.com/reference/android/arch/lifecycle/ViewModel.html" target="_blank" rel="external">ViewModel</a> 中，并且<code>ViewModel</code>仅暴露不可变的 <code>LiveData</code> 对象给观察者。</p>
</blockquote>
<p>在 <code>WordDao</code>中，改变 <code>getWords()</code>方法签名使得它返回被<code>LiveData</code> 包裹的<code>List&lt;Word&gt;</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Query</span>(<span class="string">"SELECT * from word_table ORDER BY word ASC"</span>)</div><div class="line">   LiveData&lt;List&lt;Word&gt;&gt; getAllWords();</div></pre></td></tr></table></figure>
<p>再之后的示例中，你会创建一个数据的 <code>Observer</code>在<code>MainActivity</code>的<code>onCreate()</code> 方法中，并且复写观察者的 <code>onChanged()</code> 方法。当<code>LiveData</code>改变，观察者会被通知到，并调用 <code>onChanged()</code>方法。你将更新在 <code>adapter</code>中的缓存数据，并且<code>adapter</code> 将更新用户可见的内容。</p>
<blockquote>
<p>查看<a href="https://developer.android.com/topic/libraries/architecture/livedata.html" target="_blank" rel="external">LiveData</a>文档来学习更多关于其他使用<code>LiveData</code>的方法，或者查看这个视频：<br><a href="https://www.youtube.com/watch?v=jCw5ib0r9wg" target="_blank" rel="external">Architecture Components: LifeData and Lifecycle – YouTube</a></p>
</blockquote>
<h3 id="7-加入-Room-数据库"><a href="#7-加入-Room-数据库" class="headerlink" title="7. 加入 Room 数据库"></a>7. 加入 Room 数据库</h3><h4 id="Room-数据库是什么？"><a href="#Room-数据库是什么？" class="headerlink" title="Room 数据库是什么？"></a>Room 数据库是什么？</h4><p>Room 是一个在 SQLite 数据库之上的数据库层。Room 负责处理你过去使用 SQLiteOpenHelper 所做的常见工作。</p>
<ul>
<li>Room 用 DAO 问题查询它的数据库。</li>
<li>默认的，为了避免低下的 UI 性能，Room 不允许你在主线程进行操作。在需要时，<code>LiveData</code> 自动的使用这些规则在后台线程运行异步操作。</li>
<li>Room 提供了对 SQLite 的编译时检查。</li>
<li>你的 Room 类必须是抽象的并且继承于 <code>RoomDatabase</code>。</li>
<li>通常，你在整个应用程序中仅仅需要一个 Room 数据库实例。</li>
</ul>
<h4 id="实现-Room-数据库"><a href="#实现-Room-数据库" class="headerlink" title="实现 Room 数据库"></a>实现 Room 数据库</h4><ol>
<li>创建一个继承于 <code>RoomDatabase</code> <code>public abstract</code>类，并调用它的 <code>WordRoomDatabase</code>。<code>public abstract class WordRoomDatabase extends RoomDatabase {}</code></li>
<li>注解这个类为一个 Room 数据库，声明这个实体属于一个数据库，并设置它的版本号。列出实体将在数据库中创建的表。</li>
<li>定义为数据库工作的 DAOs。为每一个 @Dao 提供一个抽象的 “getter” 方法。<code>public abstract WordDao wordDao();</code></li>
</ol>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Database</span>(entities = &#123;Word.class&#125;, version = <span class="number">1</span>)</div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">WordRoomDatabase</span> <span class="keyword">extends</span> <span class="title">RoomDatabase</span> </span>&#123;</div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> WordDao <span class="title">wordDao</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>使得 <code>WordRoomDatabase</code> 为一个单例，防止同时打开多个数据库实例。</li>
</ol>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> WordRoomDatabase INSTANCE;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> WordRoomDatabase <span class="title">getDatabase</span><span class="params">(<span class="keyword">final</span> Context context)</span> </span>&#123;</div><div class="line">   <span class="keyword">if</span> (INSTANCE == <span class="keyword">null</span>) &#123;</div><div class="line">       <span class="keyword">synchronized</span> (WordRoomDatabase.class) &#123;</div><div class="line">           <span class="keyword">if</span> (INSTANCE == <span class="keyword">null</span>) &#123;</div><div class="line">               <span class="comment">// Create database here</span></div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> INSTANCE;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>添加这段代码来得到数据库。这段代码使用 Room 数据库构建器从 WordRoomDatabase 类创建一个 RoomDatabase 对象到 application context 中，并命名为 <code>&quot;word_database&quot;</code>。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Create database here</span></div><div class="line">INSTANCE = Room.databaseBuilder(context.getApplicationContext(),</div><div class="line">       WordRoomDatabase.class, <span class="string">"word_database"</span>)</div><div class="line">       .build();</div></pre></td></tr></table></figure>
<p>以下是这个类的完整代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Database</span>(entities = &#123;Word.class&#125;, version = <span class="number">1</span>)</div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">WordRoomDatabase</span> <span class="keyword">extends</span> <span class="title">RoomDatabase</span> </span>&#123;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> WordDao <span class="title">wordDao</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">   <span class="keyword">private</span> <span class="keyword">static</span> WordRoomDatabase INSTANCE;</div><div class="line"></div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">static</span> WordRoomDatabase <span class="title">getDatabase</span><span class="params">(<span class="keyword">final</span> Context context)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (INSTANCE == <span class="keyword">null</span>) &#123;</div><div class="line">           <span class="keyword">synchronized</span> (WordRoomDatabase.class) &#123;</div><div class="line">               <span class="keyword">if</span> (INSTANCE == <span class="keyword">null</span>) &#123;</div><div class="line">                   INSTANCE = Room.databaseBuilder(context.getApplicationContext(),</div><div class="line">                           WordRoomDatabase.class, <span class="string">"word_database"</span>)</div><div class="line">                           .build();                </div><div class="line"></div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> INSTANCE;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>在本次示例中，你将不用升级实体和版本号。当你更改数据库架构，你需要更新版本号并定义怎样处理迁移。</p>
<p>例如，销毁并重建数据库是一个好的迁移策略。对于一个真正的应用程序，你必须实现迁移策略。详见：<a href="https://medium.com/google-developers/understanding-migrations-with-room-f01e04b07929" target="_blank" rel="external">Understanding migrations with Room</a>。</p>
<p>在 Android Studio 中，如果你在复制粘贴这段代码时，或在 build 进程期间得到一些错误，选则 Build &gt; Clean Project。然后选则 Build &gt; Rebuild Project，然后再次编译。如果你用提供的代码，当你构建应用程序时应该是没有错误的。</p>
</blockquote>
<h3 id="8-创建仓库（存储库）"><a href="#8-创建仓库（存储库）" class="headerlink" title="8. 创建仓库（存储库）"></a>8. 创建仓库（存储库）</h3><h4 id="仓库是什么？"><a href="#仓库是什么？" class="headerlink" title="仓库是什么？"></a>仓库是什么？</h4><p>仓库是一个能够访问多个数据源的抽象类。仓库不是结构化组件库的一部分，但是是建议的代码分离和结构化的最佳实践。一个 <code>Repository</code> 类处理数据操作。它用干净的 API 为应用程序的其他部分提供数据。</p>
<p> <img src="https://ws1.sinaimg.cn/large/006tNc79gy1ftqvnr2tvrj30ds04oaa3.jpg" alt="Repository"></p>
<h4 id="为什么使用仓库？"><a href="#为什么使用仓库？" class="headerlink" title="为什么使用仓库？"></a>为什么使用仓库？</h4><p>一个仓库管理查询线程，并允许你使用多个后端。在大多数例子中，仓库实现了是从网络抓取数据，还是用缓存到本地数据库中的数据的逻辑。</p>
<h4 id="实现仓库"><a href="#实现仓库" class="headerlink" title="实现仓库"></a>实现仓库</h4><ol>
<li>创建一个叫做<code>WordRepository</code>的公共类。</li>
<li>添加 DAO 和单词列表 (the list of words) 为成员变量。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> WordDao mWordDao;</div><div class="line"><span class="keyword">private</span> LiveData&lt;List&lt;Word&gt;&gt; mAllWords;</div></pre></td></tr></table></figure>
<ol>
<li>添加一个构造器，在其中拿到数据库并初始化成员变量。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">WordRepository(Application application) &#123;</div><div class="line">    WordRoomDatabase db = WordRoomDatabase.getDatabase(application);</div><div class="line">    mWordDao = db.wordDao();</div><div class="line">    mAllWords = mWordDao.getAllWords();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>为<code>getAllWords()</code>添加一层封装。Room 在一个独立的线程执行所有的操作。当数据改变了，被观察的 <code>LiveData</code>将通知其观察者。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">WordRepository(Application application) &#123;</div><div class="line">    WordRoomDatabase db = WordRoomDatabase.getDatabase(application);</div><div class="line">    mWordDao = db.wordDao();</div><div class="line">    mAllWords = mWordDao.getAllWords();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>为 <code>insert()</code>方法添加一层封装。你必须在非主线程调用它，否则你的应用程序将崩溃。Room 确保你不能在主线程做任何耗时操作，以免阻塞 UI。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span> <span class="params">(Word word)</span> </span>&#123;</div><div class="line">    <span class="keyword">new</span> insertAsyncTask(mWordDao).execute(word);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>关于 <code>AsyncTask</code>没什么惊奇的，所以你经管 copy 它吧。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">insertAsyncTask</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">Word</span>, <span class="title">Void</span>, <span class="title">Void</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> WordDao mAsyncTaskDao;</div><div class="line"></div><div class="line">    insertAsyncTask(WordDao dao) &#123;</div><div class="line">        mAsyncTaskDao = dao;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> Void <span class="title">doInBackground</span><span class="params">(<span class="keyword">final</span> Word... params)</span> </span>&#123;</div><div class="line">        mAsyncTaskDao.insert(params[<span class="number">0</span>]);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以下是完整代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordRepository</span> </span>&#123;</div><div class="line"></div><div class="line">   <span class="keyword">private</span> WordDao mWordDao;</div><div class="line">   <span class="keyword">private</span> LiveData&lt;List&lt;Word&gt;&gt; mAllWords;</div><div class="line"></div><div class="line">   WordRepository(Application application) &#123;</div><div class="line">       WordRoomDatabase db = WordRoomDatabase.getDatabase(application);</div><div class="line">       mWordDao = db.wordDao();</div><div class="line">       mAllWords = mWordDao.getAllWords();</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   LiveData&lt;List&lt;Word&gt;&gt; getAllWords() &#123;</div><div class="line">       <span class="keyword">return</span> mAllWords;</div><div class="line">   &#125;</div><div class="line"></div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span> <span class="params">(Word word)</span> </span>&#123;</div><div class="line">       <span class="keyword">new</span> insertAsyncTask(mWordDao).execute(word);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">insertAsyncTask</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">Word</span>, <span class="title">Void</span>, <span class="title">Void</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">       <span class="keyword">private</span> WordDao mAsyncTaskDao;</div><div class="line"></div><div class="line">       insertAsyncTask(WordDao dao) &#123;</div><div class="line">           mAsyncTaskDao = dao;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="meta">@Override</span></div><div class="line">       <span class="function"><span class="keyword">protected</span> Void <span class="title">doInBackground</span><span class="params">(<span class="keyword">final</span> Word... params)</span> </span>&#123;</div><div class="line">           mAsyncTaskDao.insert(params[<span class="number">0</span>]);</div><div class="line">           <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>对于这个简单的例子，仓库并没有做太多事。更复杂的实现参看 <a href="https://github.com/googlesamples/android-architecture-components/tree/master/BasicSample" target="_blank" rel="external">BasicSample</a>。</p>
</blockquote>
<h3 id="9-创建-ViewModel"><a href="#9-创建-ViewModel" class="headerlink" title="9. 创建 ViewModel"></a>9. 创建 ViewModel</h3><h4 id="什么是-ViewModel"><a href="#什么是-ViewModel" class="headerlink" title="什么是 ViewModel"></a>什么是 ViewModel</h4><p> <code>ViewModel</code>的角色是提供数据给 UI 并在配置改变时继续存在。一个 <code>ViewModel</code> 在仓库和 UI 之间作为通信中心。你也能用<code>ViewModel</code>在 fragment 间共享数据。ViewModel 是 <a href="https://developer.android.com/topic/libraries/architecture/lifecycle.html" target="_blank" rel="external">lifecycle library</a> 的一部分。</p>
<p> <img src="https://ws4.sinaimg.cn/large/006tNc79gy1ftr1cilhxqj30d1082aae.jpg" alt="ViewModel with Activity Instance">。</p>
<p> 关于这个话题的介绍指南参看 <a href="https://developer.android.com/topic/libraries/architecture/viewmodel.html" target="_blank" rel="external">ViewModel</a>。</p>
<h4 id="为什么用-ViewModel？"><a href="#为什么用-ViewModel？" class="headerlink" title="为什么用 ViewModel？"></a>为什么用 ViewModel？</h4><p>一个 <code>ViewModel</code> 以具有生命周期意识的方式持有你应用程序 UI 上的数据，并在配置更改后继续存在。它从 <code>Activity</code> 和 <code>Fragment</code> 上分离了 UI 数据，使你更好的遵守单一职责原则：你的 activities 和 fragments 的责任在于将数据绘制于屏幕上，而你的 <code>ViewModel</code>仅持有并处理 UI 上所必须的数据。<br>在 <code>ViewModel</code>中，为将在 UI 上用到或显示的可变的数据使用 <code>LiveData</code>。使用 <code>LiveData</code>有几个好处：</p>
<ul>
<li>你能添加一个观察者到数据上（而不是轮训数据的改变），并在数据确实改变时更新 UI。</li>
<li>仓库和 UI 是完全独立于 <code>ViewModel</code>的。<code>ViewModel</code>中没有调用数据库，使得代码更易于测试。</li>
</ul>
<h4 id="实现-ViewModel"><a href="#实现-ViewModel" class="headerlink" title="实现 ViewModel"></a>实现 ViewModel</h4><ol>
<li>创建一个名为 <code>WordViewModel</code>的类，使他继承自 <code>AndroidViewModel</code>。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordViewModel</span> <span class="keyword">extends</span> <span class="title">AndroidViewModel</span> </span>&#123;&#125;</div></pre></td></tr></table></figure>
<ol>
<li>添加一个私有成员变量来持有对仓库的引用。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> WordRepository mRepository;</div></pre></td></tr></table></figure>
<ol>
<li>添加一个私有的 <code>LiveData</code> 成员变量来缓存单词列表。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> LiveData&lt;List&lt;Word&gt;&gt; mAllWords;</div></pre></td></tr></table></figure>
<ol>
<li>添加一个构造器来得到一个仓库的引用，并从仓库得到整个单词列表。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">WordViewModel</span> <span class="params">(Application application)</span> </span>&#123;</div><div class="line">       <span class="keyword">super</span>(application);</div><div class="line">       mRepository = <span class="keyword">new</span> WordRepository(application);</div><div class="line">       mAllWords = mRepository.getAllWords();</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<ol>
<li>添加为获得全部单词的一个 “getter” 方法。这对 UI 来说完全的隐藏了实现。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">LiveData&lt;List&lt;Word&gt;&gt; getAllWords() &#123; <span class="keyword">return</span> mAllWords; &#125;</div></pre></td></tr></table></figure>
<ol>
<li>为<code>insert()</code>方法创建一层封装，它调用了仓库的 <code>insert()</code>方法。通过这种封装，<code>insert()</code>方法的实现对于 UI 也是完全隐藏的。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(Word word)</span> </span>&#123; mRepository.insert(word); &#125;</div></pre></td></tr></table></figure>
<p>这里是<code>WordViewModel</code>类的完整代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordViewModel</span> <span class="keyword">extends</span> <span class="title">AndroidViewModel</span> </span>&#123;</div><div class="line"></div><div class="line">   <span class="keyword">private</span> WordRepository mRepository;</div><div class="line"></div><div class="line">   <span class="keyword">private</span> LiveData&lt;List&lt;Word&gt;&gt; mAllWords;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="title">WordViewModel</span> <span class="params">(Application application)</span> </span>&#123;</div><div class="line">       <span class="keyword">super</span>(application);</div><div class="line">       mRepository = <span class="keyword">new</span> WordRepository(application);</div><div class="line">       mAllWords = mRepository.getAllWords();</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   LiveData&lt;List&lt;Word&gt;&gt; getAllWords() &#123; <span class="keyword">return</span> mAllWords; &#125;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(Word word)</span> </span>&#123; mRepository.insert(word); &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>警告：永远不要让上下文进入<code>ViewModel</code>实例中。不要在 <code>ViewModel</code>中存储 <code>Activity</code>, <code>Fragment</code>, 或者<code>View</code>实例或它们的<code>Context</code>。<br>例如，当设备旋转时，一个 <code>Activity</code>会在<code>ViewModel</code>的生命周期中销毁并创建多次。如果你在 <code>ViewModel</code>中存储了 <code>Activity</code>的引用，你将始终持有本该被销毁的引用。这将导致内存泄漏。<br>如果你需要该应用的上下文，请向本次示例中那样使用 <code>AndroidViewModel</code>。</p>
</blockquote>
<hr>
<blockquote>
<p>重点：<code>ViewModel</code>没有代替<code>onSaveInstanceState()</code> 方法，因为<code>ViewModel</code>在进程销毁后不在存活。点<a href="https://medium.com/google-developers/viewmodels-persistence-onsaveinstancestate-restoring-ui-state-and-loaders-fc7cc4a6c090" target="_blank" rel="external">这里</a>查看更多。</p>
</blockquote>
<hr>
<p>点这里查看有关 <a href="https://www.youtube.com/watch?v=c9-057jC1ZA" target="_blank" rel="external">ViewModel</a> 更多的知识。</p>
<h3 id="10-添加-XML-布局文件"><a href="#10-添加-XML-布局文件" class="headerlink" title="10.  添加 XML 布局文件"></a>10.  添加 XML 布局文件</h3><p>接下来，你需要为每条列表项（items）和列表添加一个 XML 布局文件。</p>
<p>该实例假设你能熟练的创建 XML 布局文件，所以我们仅提供代码给你而不必做讲解。</p>
<p>在 <code>values/styles.xml</code>中为每条列表项添加风格：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- The default font for RecyclerView items is too small.</span></div><div class="line">The margin is a simple delimiter between the words. --&gt;</div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"word_title"</span>&gt;</span><span class="xml"></span></div><div class="line">   <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:layout_width"</span>&gt;</span>match_parent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:layout_height"</span>&gt;</span>26dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textSize"</span>&gt;</span>24sp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textStyle"</span>&gt;</span>bold<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:layout_marginBottom"</span>&gt;</span>6dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:paddingLeft"</span>&gt;</span>8dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>添加一个 <code>layout/recyclerview_item.xml</code>布局：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span> <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/textView"</span></div><div class="line">        <span class="attr">style</span>=<span class="string">"@style/word_title"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"@android:color/holo_orange_light"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>在 <code>layout/content_main.xml</code>中，替换原有布局元素为 <code>RecyclerView</code>：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></div><div class="line">   <span class="attr">android:id</span>=<span class="string">"@+id/recyclerview"</span></div><div class="line">   <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">   <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">   <span class="attr">android:background</span>=<span class="string">"@android:color/darker_gray"</span></div><div class="line">   <span class="attr">tools:listitem</span>=<span class="string">"@layout/recyclerview_item"</span> /&gt;</div></pre></td></tr></table></figure></p>
<p>你的浮动操作按钮（FAB）应与可用操作相对应。在 <code>layout/activity_main.xml</code>文件中，给 <code>FloatingActionButton</code>添加 <code>+</code>号图标：</p>
<ol>
<li>在 <code>layout/activity_main.xml</code>文件中，选择  <strong>File &gt; New &gt; Vector Asset</strong>。</li>
<li>选择 <strong>Material Icon</strong>。</li>
<li>在 <strong>Icon</strong>中点击 Android 机器人图标，然后选择<code>+</code>(“add”) asset。</li>
<li>改变布局文件代码为：<code>android:src=&quot;@drawable/ic_add_black_24dp</code></li>
</ol>
<h3 id="11-添加一个-RecyclerView"><a href="#11-添加一个-RecyclerView" class="headerlink" title="11. 添加一个 RecyclerView"></a>11. 添加一个 RecyclerView</h3><p>你正继续为了在 <code>RecyclerView</code> 中显示数据，比起直接将数据显示到 <code>TextView</code>中，它更好一点。该实例假设你知道<code>RecyclerView</code>，<code>RecyclerView.LayoutManager</code>，<code>RecyclerView.ViewHolder</code>, 和<code>RecyclerView.Adapter</code>如何工作的。</p>
<p>注意，在 adapter 中的<code>mWords</code>变量用于缓存数据。接下来，你要添加代码使得数据能自动更新。</p>
<p>也要注意 <code>getItemCount()</code>方法需要优雅地考虑到数据尚未准备好且mWords仍为null的可能性。在更加复杂的应用程序中，你可以为用户显示占位数据或其他有意义的东西。</p>
<p>添加一个继承自 <code>RecyclerView.Adapter</code>的<code>WordListAdapter</code>类。代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordListAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">WordListAdapter</span>.<span class="title">WordViewHolder</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">   <span class="class"><span class="keyword">class</span> <span class="title">WordViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</div><div class="line">       <span class="keyword">private</span> <span class="keyword">final</span> TextView wordItemView;</div><div class="line"></div><div class="line">       <span class="function"><span class="keyword">private</span> <span class="title">WordViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</div><div class="line">           <span class="keyword">super</span>(itemView);</div><div class="line">           wordItemView = itemView.findViewById(R.id.textView);</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="keyword">private</span> <span class="keyword">final</span> LayoutInflater mInflater;</div><div class="line">   <span class="keyword">private</span> List&lt;Word&gt; mWords; <span class="comment">// Cached copy of words</span></div><div class="line"></div><div class="line">   WordListAdapter(Context context) &#123; mInflater = LayoutInflater.from(context); &#125;</div><div class="line"></div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> WordViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</div><div class="line">       View itemView = mInflater.inflate(R.layout.recyclerview_item, parent, <span class="keyword">false</span>);</div><div class="line">       <span class="keyword">return</span> <span class="keyword">new</span> WordViewHolder(itemView);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(WordViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (mWords != <span class="keyword">null</span>) &#123;</div><div class="line">           Word current = mWords.get(position);</div><div class="line">           holder.wordItemView.setText(current.getWord());</div><div class="line">       &#125; <span class="keyword">else</span> &#123;</div><div class="line">           <span class="comment">// Covers the case of data not being ready yet.</span></div><div class="line">           holder.wordItemView.setText(<span class="string">"No Word"</span>);</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">void</span> <span class="title">setWords</span><span class="params">(List&lt;Word&gt; words)</span></span>&#123;</div><div class="line">       mWords = words;</div><div class="line">       notifyDataSetChanged();</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="comment">// getItemCount() is called many times, and when it is first called,</span></div><div class="line">   <span class="comment">// mWords has not been updated (means initially, it's null, and we can't return null).</span></div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (mWords != <span class="keyword">null</span>)</div><div class="line">           <span class="keyword">return</span> mWords.size();</div><div class="line">       <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>添加<code>RecyclerView</code>到 <code>MainActivity</code>的<code>onCreate()</code>方法中。在 <code>onCreate()</code>方法中：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">RecyclerView recyclerView = findViewById(R.id.recyclerview);</div><div class="line"><span class="keyword">final</span> WordListAdapter adapter = <span class="keyword">new</span> WordListAdapter(<span class="keyword">this</span>);</div><div class="line">recyclerView.setAdapter(adapter);</div><div class="line">recyclerView.setLayoutManager(<span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>));</div></pre></td></tr></table></figure></p>
<p>运行你的应用程序确保一切正常。现在没有任何列表项，因为你还没为 <code>RecyclerView</code>勾住数据，所以应用程序在没有任何列表项时显示灰色的背景。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1ftr3bbp618j30p018gwfi.jpg" alt="Empty RecyclerView"></p>
<h3 id="12-填充数据库"><a href="#12-填充数据库" class="headerlink" title="12. 填充数据库"></a>12. 填充数据库</h3><p>数据库中没有数据。你有两种方式添加数据：在打开数据库时添加一些数据和添加一个用于添加单词的 <code>Activity</code>。</p>
<p>要在应用程序启动时删除所有内容并重新填充数据库，你要创建<a href="https://developer.android.com/reference/android/arch/persistence/room/RoomDatabase.Callback.html" target="_blank" rel="external">RoomDatabase.Callback</a>并覆盖<code>onOpen()</code>。因为你不能在 UI 线程操作 Room 数据库，<code>onOpen()</code>方法创建并执行了一个<code>AsyncTask</code>来为数据库添加内容。</p>
<p>这些代码是在 <code>WordRoomDatabase</code>类中创建回调：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> RoomDatabase.Callback sRoomDatabaseCallback =</div><div class="line">    <span class="keyword">new</span> RoomDatabase.Callback()&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span> <span class="params">(@NonNull SupportSQLiteDatabase db)</span></span>&#123;</div><div class="line">        <span class="keyword">super</span>.onOpen(db);</div><div class="line">       <span class="keyword">new</span> PopulateDbAsync(INSTANCE).execute();</div><div class="line">   &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>下面的代码为 AsyncTask 删除数据库内容，然后用两个单词 “Hello” 和 “World” 重新填充数据库。你可以随意添加更多单词！<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PopulateDbAsync</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">Void</span>, <span class="title">Void</span>, <span class="title">Void</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">   <span class="keyword">private</span> <span class="keyword">final</span> WordDao mDao;</div><div class="line"></div><div class="line">   PopulateDbAsync(WordRoomDatabase db) &#123;</div><div class="line">       mDao = db.wordDao();</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">protected</span> Void <span class="title">doInBackground</span><span class="params">(<span class="keyword">final</span> Void... params)</span> </span>&#123;</div><div class="line">       mDao.deleteAll();</div><div class="line">       Word word = <span class="keyword">new</span> Word(<span class="string">"Hello"</span>);</div><div class="line">       mDao.insert(word);</div><div class="line">       word = <span class="keyword">new</span> Word(<span class="string">"World"</span>);</div><div class="line">       mDao.insert(word);</div><div class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最后，在调用<code>.build()</code>前将回调添加到数据库构建序列。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.addCallback(sRoomDatabaseCallback)</div></pre></td></tr></table></figure></p>
<h3 id="13-添加-NewWordActivity"><a href="#13-添加-NewWordActivity" class="headerlink" title="13. 添加 NewWordActivity"></a>13. 添加 NewWordActivity</h3><p>添加字符串资源到 <code>values/strings.xml</code>：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"hint_word"</span>&gt;</span>Word...<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"button_save"</span>&gt;</span>Save<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"empty_not_saved"</span>&gt;</span>Word not saved because it is empty.<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>添加颜色资源到 <code>value/colors.xml</code>：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"buttonLabel"</span>&gt;</span>#d3d3d3<span class="tag">&lt;/<span class="name">color</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>添加尺寸资源到 <code>values/dimens.xml</code>：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"small_padding"</span>&gt;</span>6dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"big_padding"</span>&gt;</span>16dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>创建一个 <code>activity_new_word.xml</code>文件到布局文件夹：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">   <span class="attr">android:orientation</span>=<span class="string">"vertical"</span> <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">   <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line">   <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">       <span class="attr">android:id</span>=<span class="string">"@+id/edit_word"</span></div><div class="line">       <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">       <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">       <span class="attr">android:fontFamily</span>=<span class="string">"sans-serif-light"</span></div><div class="line">       <span class="attr">android:hint</span>=<span class="string">"@string/hint_word"</span></div><div class="line">       <span class="attr">android:inputType</span>=<span class="string">"textAutoComplete"</span></div><div class="line">       <span class="attr">android:padding</span>=<span class="string">"@dimen/small_padding"</span></div><div class="line">       <span class="attr">android:layout_marginBottom</span>=<span class="string">"@dimen/big_padding"</span></div><div class="line">       <span class="attr">android:layout_marginTop</span>=<span class="string">"@dimen/big_padding"</span></div><div class="line">       <span class="attr">android:textSize</span>=<span class="string">"18sp"</span> /&gt;</div><div class="line"></div><div class="line">   <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">       <span class="attr">android:id</span>=<span class="string">"@+id/button_save"</span></div><div class="line">       <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">       <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">       <span class="attr">android:background</span>=<span class="string">"@color/colorPrimary"</span></div><div class="line">       <span class="attr">android:text</span>=<span class="string">"@string/button_save"</span></div><div class="line">       <span class="attr">android:textColor</span>=<span class="string">"@color/buttonLabel"</span> /&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>用一个空的 Activity 模版来创建一个新的 Activity，<code>NewWordActivity</code>。验证这个 activity 已经被添加到 Android Manifest 中！<br><code>&lt;activity android:name=&quot;.NewWordActivity&quot;&gt;&lt;/activity&gt;</code><br>这里是该 activity 的代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewWordActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXTRA_REPLY = <span class="string">"com.example.android.wordlistsql.REPLY"</span>;</div><div class="line"></div><div class="line">   <span class="keyword">private</span>  EditText mEditWordView;</div><div class="line"></div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">       <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">       setContentView(R.layout.activity_new_word);</div><div class="line">       mEditWordView = findViewById(R.id.edit_word);</div><div class="line"></div><div class="line">       <span class="keyword">final</span> Button button = findViewById(R.id.button_save);</div><div class="line">       button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">               Intent replyIntent = <span class="keyword">new</span> Intent();</div><div class="line">               <span class="keyword">if</span> (TextUtils.isEmpty(mEditWordView.getText())) &#123;</div><div class="line">                   setResult(RESULT_CANCELED, replyIntent);</div><div class="line">               &#125; <span class="keyword">else</span> &#123;</div><div class="line">                   String word = mEditWordView.getText().toString();</div><div class="line">                   replyIntent.putExtra(EXTRA_REPLY, word);</div><div class="line">                   setResult(RESULT_OK, replyIntent);</div><div class="line">               &#125;</div><div class="line">               finish();</div><div class="line">           &#125;</div><div class="line">       &#125;);</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="14-连接数据"><a href="#14-连接数据" class="headerlink" title="14. 连接数据"></a>14. 连接数据</h3><p>最后一步是通过保存用户输入的新单词并显示当前的单词数据库内容到 <code>RecyclerView</code>上来连接 UI 和 数据库。</p>
<p>要显示数据库的当前内容，需要添加一个观察者，该观察者在 <code>ViewModel</code> 中观察<code>LiveData</code>。无论数据何时改变，<code>onChanged()</code>回调将被唤起，它将调用适配器的 <code>setWord()</code> 方法来更新适配器缓存的数据并刷新显示的列表。</p>
<p>在 <code>MainActivity</code>中，为 <code>ViewModel</code>创建一个成员变量：<br><code>private WordViewModel mWordViewModel;</code><br>使用 <a href="https://developer.android.com/reference/android/arch/lifecycle/ViewModelProviders.html" target="_blank" rel="external">ViewModelProviders</a> 来关联你的 <code>ViewModel</code> 和你的 UI 控制器。当你的应用程序第一次启动，<code>ViewModelProviders</code>将创建<code>ViewModel</code>。当 Activity 销毁，例如配置改变时，<code>ViewModel</code>任然存在。当 Activity 重新创建时，<code>ViewModelProviders</code>返回这个已经存在的 <code>ViewModel</code>。详见 <a href="https://developer.android.com/topic/libraries/architecture/viewmodel.html" target="_blank" rel="external">ViewModel</a>。</p>
<p>在 <code>onCreate()</code>中，从<code>ViewModelProvider</code>中获取<code>ViewModel</code>。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mWordViewModel = ViewModelProviders.of(<span class="keyword">this</span>).get(WordViewModel.class);</div></pre></td></tr></table></figure></p>
<p>同样在<code>onCreate()</code>中，为返回<code>getAllWords()</code>给<code>LiveData</code>添加一个观察者。<code>onChanged()</code>方法在被观察的数据改变并且 Activity 在前台时调用。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mWordViewModel.getAllWords().observe(<span class="keyword">this</span>, <span class="keyword">new</span> Observer&lt;List&lt;Word&gt;&gt;() &#123;</div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChanged</span><span class="params">(@Nullable <span class="keyword">final</span> List&lt;Word&gt; words)</span> </span>&#123;</div><div class="line">       <span class="comment">// Update the cached copy of the words in the adapter.</span></div><div class="line">       adapter.setWords(words);</div><div class="line">   &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>在 <code>MainActivity</code>中，为<code>NewWordActivity</code>添加 <code>onActivityResult()</code>方法。</p>
<p>如果 Activity 返回 <code>RESULT_OK</code>，通过调用 <code>WordViewModel</code>的<code>insert()</code>方法将返回的单词插入到数据库中。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span> </span>&#123;</div><div class="line">   <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, data);</div><div class="line"></div><div class="line">   <span class="keyword">if</span> (requestCode == NEW_WORD_ACTIVITY_REQUEST_CODE &amp;&amp; resultCode == RESULT_OK) &#123;</div><div class="line">       Word word = <span class="keyword">new</span> Word(data.getStringExtra(NewWordActivity.EXTRA_REPLY));</div><div class="line">       mWordViewModel.insert(word);</div><div class="line">   &#125; <span class="keyword">else</span> &#123;</div><div class="line">       Toast.makeText(</div><div class="line">               getApplicationContext(),</div><div class="line">               R.string.empty_not_saved,</div><div class="line">               Toast.LENGTH_LONG).show();</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>定义上面代码中缺失的请求码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NEW_WORD_ACTIVITY_REQUEST_CODE = <span class="number">1</span>;</div></pre></td></tr></table></figure></p>
<p>当用户点击 FAB 时，在 <code>MainActivity</code> 中启动<code>NewWordActivity</code>。处理这次 FABB 点击事件的代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Intent intent = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, NewWordActivity.class);</div><div class="line">startActivityForResult(intent, NEW_WORD_ACTIVITY_REQUEST_CODE);</div></pre></td></tr></table></figure></p>
<p>运行你的程序吧！！！<br>当你在 <code>NewWordActivity</code>中添加新的单词时，UI 将会自动更新。</p>
<h3 id="15-总结"><a href="#15-总结" class="headerlink" title="15. 总结"></a>15. 总结</h3><p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1ftr4rou9tfj30fi0cqaaw.jpg" alt="Room with UI"></p>
<p>既然你有一个可用的应用程序，让我们回顾一下你构建的内容吧。从一开始讲起，这又回到了应用程序结构。</p>
<p>你有一个用于显示列表中的单词的应用程序（<code>MainActivity</code>，<code>RecyclerView</code>，<code>WordListAdapter</code>）。</p>
<p>您可以添加单词到列表中（<code>NewWordActivity</code>）。</p>
<p>单词是Word实体类的实例。</p>
<p>这些单词作为单词列表（<code>mWords</code>）被缓存在<code>RecyclerViewAdapter</code>中。 当数据库中的单词发生改变时，该单词列表会自动更新并重新显示。</p>
<h4 id="自更新-UI-的数据流（响应式-UI）"><a href="#自更新-UI-的数据流（响应式-UI）" class="headerlink" title="自更新 UI 的数据流（响应式 UI）"></a>自更新 UI 的数据流（响应式 UI）</h4><p>因为我们使用了 <code>LiveData</code>使得自动更新成为可能。在 <code>MainActivity</code>中，有一个观察者，它从数据库中观察单词的<code>LiveData</code>，并在它们变化时收到通知。当有变化发生，观察者的 <code>onChange</code>方法将被执行并更新<code>WordListAdaptre</code>中的 <code>mWords</code>。</p>
<p>这些数据是可观察的，因为它是 <code>LiveData</code>。观察到的是 <code>LiveData&lt;List&lt;Word&gt;&gt;</code>，它通过 <code>WordViewModel</code>对象的<code>getAllWords()</code>方法返回。</p>
<p><code>WordVieModel</code> 隐藏了 UI 层背后的所有实现。它提供了访问数据层的方法，并返回 <code>LiveData</code> 使得 <code>MainActivity</code> 能设置观察者关系。<code>Views</code>和<code>Activities</code>（以及<code>Fragments</code>）仅通过<code>ViewModel</code>于数据相交互。因此，数据从哪来的对它是无关紧要的。</p>
<p>在这个例子中，数据来自<code>Repository</code>。<code>ViewModel</code>不必知道仓库和什么交互。它仅需要知道怎样域仓库交互<code>Repository</code>，那是通过<code>Repository</code> 暴露的方法来完成的。</p>
<p>仓库管理着一个或多个数据源。在<code>WordLstSample</code>应用程序中，后端是一个 Room 数据库。Room 是一个包装器并实现了一个 SQLite 数据库。Room 为你做了许多之前你不得不自己做的工作。例如，Room 能执行你以前使用 SQLiteOpenHelper 类所做的所有操作。</p>
<p>数据库操作时调用的 DAO 映射方法，使你在调用仓库的方法（例如：<code>getAllWords()</code>）时，Room 能执行 <code>SELECT * from word_table ORDER BY word ASC</code>。</p>
<p>因为返回查询的结果是被观察的 <code>LiveData</code>类型，每次在 Room 中改变的数据，<code>Observer</code> 接口的 <code>onChanged()</code> 方法会被执行并更新 UI。</p>

      
      
        <div class="page-reward">
          <p><a href="javascript:void(0)" onclick="dashangToggle()" class="dashang" title="打赏，支持一下">赏</a></p>
          <div class="hide_box"></div>
          <div class="shang_box">
            <a class="shang_close" href="javascript:void(0)" onclick="dashangToggle()" title="关闭">×</a>
            <div class="shang_tit">
              <p>纯属好玩</p>
            </div>
            <div class="shang_payimg">
              <img src="/img/alipayimg.jpg" alt="扫码支持" title="扫一扫" />
            </div>
              <div class="pay_explain">扫码打赏，你说多少就多少</div>
            <div class="shang_payselect">
              
                <div class="pay_item checked" data-id="alipay">
                  <span class="radiobox"></span>
                  <span class="pay_logo"><img src="/img/alipay.png" alt="支付宝" /></span>
                </div>
              
              
                <div class="pay_item" data-id="wechat">
                  <span class="radiobox"></span>
                  <span class="pay_logo"><img src="/img/weixin.png" alt="微信" /></span>
                </div>
              
            </div>
            <div class="shang_info">
              <p>打开<span id="shang_pay_txt">支付宝</span>扫一扫，即可进行扫码打赏哦</p>
            </div>
          </div>
        </div>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
        <script type="text/javascript">
          $(".pay_item").click(function(){
            $(this).addClass('checked').siblings('.pay_item').removeClass('checked');
            var dataid=$(this).attr('data-id');
            $(".shang_payimg img").attr("src","/img/"+dataid+"img.jpg");
            $("#shang_pay_txt").text(dataid=="alipay"?"支付宝":"微信");
          });
          function dashangToggle(){
            $(".hide_box").fadeToggle();
            $(".shang_box").fadeToggle();
          }
        </script>
      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2018/07/29/Android_Room_with_A_View/">Android Room with A View</a></p>
        <p><span>文章作者:</span><a href="/" title="访问 thirtyyuan 的个人博客">thirtyyuan</a></p>
        <p><span>发布时间:</span>2018年07月29日 - 23时53分</p>
        <p><span>最后更新:</span>2018年07月30日 - 08时30分</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2018/07/29/Android_Room_with_A_View/" title="Android Room with A View">http://thirtyyuan.github.io/2018/07/29/Android_Room_with_A_View/</a>
            <span class="copy-path" data-clipboard-text="原文: http://thirtyyuan.github.io/2018/07/29/Android_Room_with_A_View/　　作者: thirtyyuan" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script src="/js/clipboard.min.js"></script>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)" target = "_blank">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



<nav id="article-nav">
  
    <a href="/2018/12/01/一周年记/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          一周年记
        
      </div>
    </a>
  
  
    <a href="/2018/01/27/LeetCode/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">LeetCode Note</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-介绍"><span class="toc-number">1.</span> <span class="toc-text">1. 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#推荐给你的结构化组件是什么？"><span class="toc-number">1.1.</span> <span class="toc-text">推荐给你的结构化组件是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#你将构建什么？（需求）"><span class="toc-number">1.2.</span> <span class="toc-text">你将构建什么？（需求）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RoomWordSample-架构概览"><span class="toc-number">1.3.</span> <span class="toc-text">RoomWordSample 架构概览</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#你将学到什么？"><span class="toc-number">1.4.</span> <span class="toc-text">你将学到什么？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-创建你的应用程序"><span class="toc-number">2.</span> <span class="toc-text">2. 创建你的应用程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-更新-gradle-文件"><span class="toc-number">3.</span> <span class="toc-text">3. 更新 gradle 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-创建-Entity-实体"><span class="toc-number">4.</span> <span class="toc-text">4. 创建 Entity (实体)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-创建-DAO（Data-Access-Object）"><span class="toc-number">5.</span> <span class="toc-text">5. 创建 DAO（Data Access Object）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#什么是-DAO？"><span class="toc-number">5.1.</span> <span class="toc-text">什么是 DAO？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实现-DAO"><span class="toc-number">5.2.</span> <span class="toc-text">实现 DAO</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-LiveData-类"><span class="toc-number">6.</span> <span class="toc-text">6. LiveData 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-加入-Room-数据库"><span class="toc-number">7.</span> <span class="toc-text">7. 加入 Room 数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Room-数据库是什么？"><span class="toc-number">7.1.</span> <span class="toc-text">Room 数据库是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实现-Room-数据库"><span class="toc-number">7.2.</span> <span class="toc-text">实现 Room 数据库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-创建仓库（存储库）"><span class="toc-number">8.</span> <span class="toc-text">8. 创建仓库（存储库）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#仓库是什么？"><span class="toc-number">8.1.</span> <span class="toc-text">仓库是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#为什么使用仓库？"><span class="toc-number">8.2.</span> <span class="toc-text">为什么使用仓库？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实现仓库"><span class="toc-number">8.3.</span> <span class="toc-text">实现仓库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-创建-ViewModel"><span class="toc-number">9.</span> <span class="toc-text">9. 创建 ViewModel</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#什么是-ViewModel"><span class="toc-number">9.1.</span> <span class="toc-text">什么是 ViewModel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#为什么用-ViewModel？"><span class="toc-number">9.2.</span> <span class="toc-text">为什么用 ViewModel？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实现-ViewModel"><span class="toc-number">9.3.</span> <span class="toc-text">实现 ViewModel</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-添加-XML-布局文件"><span class="toc-number">10.</span> <span class="toc-text">10.  添加 XML 布局文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-添加一个-RecyclerView"><span class="toc-number">11.</span> <span class="toc-text">11. 添加一个 RecyclerView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-填充数据库"><span class="toc-number">12.</span> <span class="toc-text">12. 填充数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-添加-NewWordActivity"><span class="toc-number">13.</span> <span class="toc-text">13. 添加 NewWordActivity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-连接数据"><span class="toc-number">14.</span> <span class="toc-text">14. 连接数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-总结"><span class="toc-number">15.</span> <span class="toc-text">15. 总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#自更新-UI-的数据流（响应式-UI）"><span class="toc-number">15.1.</span> <span class="toc-text">自更新 UI 的数据流（响应式 UI）</span></a></li></ol></li></ol>
</div>
<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }
    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
        }
    })
    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
    }
</script>





<div class="bdsharebuttonbox">
	<a href="#" class="fx fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
	<a href="#" class="fx fa-weixin bds_weixin" data-cmd="weixin" title="分享到微信"></a>
	<a href="#" class="fx fa-qq bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
	<a href="#" class="fx fa-facebook-official bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
	<a href="#" class="fx fa-twitter bds_twi" data-cmd="twi" title="分享到Twitter"></a>
	<a href="#" class="fx fa-linkedin bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a>
	<a href="#" class="fx fa-files-o bds_copy" data-cmd="copy" title="分享到复制网址"></a>
</div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>




    
        <section id="comments">
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'thirtyyuan'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>
    



    <div class="scroll" id="post-nav-button">
        
            <a href="/2018/12/01/一周年记/" title="上一篇: 一周年记">
                <i class="fa fa-angle-left"></i>
            </a>
        
        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>
        
            <a href="/2018/01/27/LeetCode/" title="下一篇: LeetCode Note">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>
    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/12/01/一周年记/">一周年记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/29/Android_Room_with_A_View/">Android Room with A View</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/27/LeetCode/">LeetCode Note</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/02/Android踩坑笔记/">Android踩坑笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/30/Nice_to_meet_you/">Nice to meet you</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/Android-6-0-Permission/">Android 6.0 Permission</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/10/android开发——环境搭建/">android开发——环境搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/06/hello-world/">你好，世界。</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/04/给-Arduino-插上互联网的翅膀/">给 Arduino 插上互联网的翅膀</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/30/如果我能成为一名海盗/">如果我能成为一名海盗</a></li></ul>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
    <script>
        $(".post-list").addClass("toc-article");
        $(".post-list-item a").attr("target","_blank");
        $("#post-nav-button > a:nth-child(2)").click(function() {
            $(".fa-bars, .fa-times").toggle();
            $(".post-list").toggle(300);
            if ($(".toc").length > 0) {
                $("#toc, #tocButton").toggle(200, function() {
                    if ($(".switch-area").is(":visible")) {
                        $("#tocButton").attr("value", valueHide);
                        }
                    })
            }
            else {
            }
        })
    </script>



    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2019 thirtyyuan
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/luuman/hexo-theme-spfk" target="_blank">spfk</a> by luuman
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >站点访问数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 1;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


  </div>
</body>
</html>